<%- include('partials/header.ejs') %>
  <div class="container mt-3">
    <div class="row">
      
      <div class="col-lg-9">
        <div id="project_cards" class="row row-cols-1 row-cols-lg-2 align-items-stretch g-3">

        </div>
      </div>

      <div class="col-lg-3">
        <div class="card text-white mb-3">
          <div class="card-header bg-primary">Filter</div>
          <ul class="list-group">
            <li class="list-group-item bg-body-tertiary" role="button" style="border-radius: 0%">
              <div class="text-success ">
                <h6 class="my-0">All</h6>
              </div>
            </li>
            <li class="list-group-item" style="border-radius: 0%" role="button">
              <div class="">
                <h6 class="my-0">Option 1</h6>
              </div>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <%- include('partials/footer.ejs') %>
    <script>


      const PROJECTS = "projects";
      // Get projects from blockchain and display it
      const getProjects = async () => {
        const projects = await window.contract.methods.getProjects().call();
        localStorage.setItem(PROJECTS, JSON.stringify(projects));

      }

      // Display projects
      const displayProjects = () => {
        projects = JSON.parse(localStorage.getItem(PROJECTS))
        for (i = projects.length - 1; i >= 0; i--) {
          project_html = `
          
          <div class="col">
            <a href="/projects/${i}" class="nav-link">
            <div class="card card-cover object-fit-fill h-100 overflow-hidden text-bg-dark"
              style="background-image: url('${projects[i].image}'); background-size: cover;">
              <div class="d-flex flex-column h-100 p-3 pb-3 text-white text-shadow-1">
                <h4 class="pt-5 mt-5 mb-4 display-6 lh-1 fw-bold" style="text-shadow: 2px 2px 4px #000000;">${projects[i].title}</h4>
                <ul class="d-flex list-unstyled mt-auto" style="font-weight: bolder;" >
                  <li class="me-auto">
                    <small>
                      <span class="badge rounded-pill bg-warning" style="font-size:14px; font-weight:bolder;">
                        <stong>${web3.utils.fromWei(projects[i].collected, 'ether')} funded / target ${web3.utils.fromWei(projects[i].target, 'ether')}</strong>
                           ETH</span></small>
                  </li>
                 
                  <li class="d-flex align-items-center"> 
                    <small>
                      <span style="font-size:14px; font-weight:bolder; text-shadow: 2px 2px 4px #000000;">
                      Deadline: ${new Date(parseInt(projects[i].deadline)).toLocaleDateString()}
                      </span>
                    </small>
                  </li>
                </ul>
              </div>
            </div>
          </a>
          </div>
          
          `;
          $("#project_cards").append(project_html);
        }
      }


      $(async function () {
        //Connect to contract
        await connectContract();

        //Display Projects
        await getProjects();
        displayProjects();
      })

    </script>