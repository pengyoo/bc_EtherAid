<%- include('partials/header.ejs') %>
<link href="https://cdn.jsdelivr.net/npm/quill@2.0.0-rc.4/dist/quill.snow.css" rel="stylesheet" />
<style>
  #editor {
    height: 10rem;
    flex: 1;
    overflow-y: auto;
    width: 100%;
    }
</style>
  <div class="container mt-3">
    <main class="form-post w-100 m-auto mt-3 p-4 card">
      <h3>Create a project...</h3>
      <form id="project_from" method="post" onsubmit="handleSubmit(event)" class="mt-2">
        <div class="form-floating">
          <input type="text" class="form-control" id="title" name="title" placeholder="title">
          <label for="title">Title</label>
        </div>
        <label class="mt-3">Description</label>
        <div class="form-floating" >
          <textarea style="display:none" rows="5" id="description" name="description" class="w-100 mt-3 p-2 pt-4"
            style="border-color: #eeeeee"></textarea>
          
          <div id="editor">
          </div>
        </div>

        <div class="input-group mt-3">
          <span class="input-group-text">ETH</span>
          <input type="number" class="form-control"  step=".01" id="target" name="target" placeholder="Target">
        </div>
        
        <div class="form-floating mt-3">
          <input type="datetime-local" class="form-control" id="deadline" name="deadline" placeholder="Deadline">
          <label for="deadline">Deadline</label>
        </div>

        <div class="form-floating mt-3">
          <input type="text" class="form-control" id="image" name="image" placeholder="">
          <label for="image">Image</label>
        </div>
        <button class="btn btn-primary w-100 py-2 my-3" type="submit">Create</button>
      </form>
      
    </main>
  </div>

  <%- include('partials/footer.ejs') %>
  <script src="https://cdn.jsdelivr.net/npm/quill@2.0.0-rc.4/dist/quill.js"></script>
    <script>
     const quill = new Quill('#editor', {
    theme: 'snow'
  });


      // Create Project through smart contract
      const createProject = (title, description, target, deadline, image) => {
        const data = window.contract.methods.create(localStorage.getItem("account"), title, description, target, deadline, image).send({ from: localStorage.getItem("account") }).then((result) => {
          window.location.href = "/";
        });
      }


      // Handle submit
      const handleSubmit = (event) => {
        event.preventDefault();
        $("#description").val(quill.root.innerHTML);
        const form = event.target;
        const formData = new FormData(form);
        const project = {};
        formData.forEach(function (value, key) {
          project[key] = value;
        });

        console.log(project);

        if (!localStorage.getItem('account')) {
          $("#toast-body").html("Please connect your wallet first");
          toastBootstrap.show();
          return;
        }
        createProject(project['title'], project['description'], project['target'] * 1000000000000000000, new Date(project['deadline']).getTime(), project['image']);

      }




      $(async function () {
        //Connect to contract
        await connectContract();


      })

    </script>